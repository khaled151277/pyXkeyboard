<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python XKeyboard - دليل المستخدم</title>
    <style>
        /* --- متغيرات المظهر الفاتح الافتراضي --- */
        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --heading-color: #111111;
            --link-color: #0066cc;
            --border-color: #eeeeee;
            --border-color-strong: #cccccc;
            --code-bg: #f4f4f4;
            --code-text: #333333;
            --code-border: #dddddd;
            --note-border: #cccccc;
            --subtle-text: #555555;
        }

        /* --- تجاوزات المظهر الداكن --- */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #2b2b2b;
                --text-color: #cccccc;
                --heading-color: #eeeeee;
                --link-color: #80bfff;
                --border-color: #444444;
                --border-color-strong: #666666;
                --code-bg: #3c3c3c;
                --code-text: #cccccc;
                --code-border: #555555;
                --note-border: #555555;
                --subtle-text: #aaaaaa;
            }
        }

        body {
            font-family: sans-serif;
            line-height: 1.6;
            margin: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        h1, h2, h3 {
            color: var(--heading-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
            margin-top: 25px;
        }
        h1 {
            text-align: center;
            border-bottom: 2px solid var(--border-color-strong);
            margin-top: 0;
        }
        a {
            color: var(--link-color);
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        code {
            background-color: var(--code-bg);
            color: var(--code-text);
            padding: 2px 5px;
            border: 1px solid var(--code-border);
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.95em;
            direction: ltr; /* Ensure code blocks remain LTR */
            display: inline-block; /* Prevent breaking */
        }
        strong {
            font-weight: bold;
            color: var(--heading-color);
        }
        ul, ol {
            margin-bottom: 15px;
            padding-right: 25px; /* Padding for RTL */
            padding-left: 0;
        }
        li {
            margin-bottom: 8px;
        }
        .note {
            border: 1px solid var(--note-border);
            padding: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
            border-radius: 4px;
            background-color: var(--code-bg); /* Subtle background for notes */
        }
        .note h2 {
            margin-top: 0;
            border-bottom: 1px dashed var(--note-border);
        }
        p {
             margin-bottom: 15px;
        }
        /* Section for About info */
        .about-section {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
    </style>
</head>
<body>

    <h1>Python XKeyboard - دليل المستخدم (إصدار 1.0.2)</h1>

    <p>مرحبًا بك في Python XKeyboard! هذه لوحة مفاتيح افتراضية بسيطة تظهر على الشاشة لمساعدتك في الكتابة والتبديل بين تخطيطات لوحة المفاتيح (مثل الإنجليزية والعربية) بسهولة، مع العديد من خيارات التخصيص.</p>

    <h2>الميزات الرئيسية:</h2>
    <ul>
        <li><strong>الكتابة على الشاشة:</strong> انقر على المفاتيح في لوحة المفاتيح الافتراضية للكتابة في تطبيقات أخرى (يتطلب ميزة XTEST، تعمل عادةً على أنظمة X11/Xorg).</li>
        <li><strong>تبديل لغة النظام:</strong> قم بتبديل تخطيط لوحة مفاتيح النظام بسرعة عبر زر <code>Lang</code> أو قائمة علبة النظام (يستخدم أمر <code>setxkbmap</code>).</li>
        <li><strong>عرض التخطيط المرئي:</strong> يتم تحديث لوحة المفاتيح الافتراضية تلقائيًا لإظهار الأحرف الخاصة بالتخطيط النشط في النظام.</li>
        <li><strong>مفاتيح التعديل:</strong> استخدم مفاتيح <code>Shift</code> (شيفت), <code>Ctrl</code> (كنترول), <code>Alt</code> (آلت) و <code>Caps Lock</code> (قفل الإدخال بالأحرف الكبيرة) في لوحة المفاتيح الافتراضية. يتم تحرير Shift/Ctrl/Alt تلقائيًا بعد الضغطة التالية.</li>
        <li><strong>شيفت بالنقر الأيمن:</strong> انقر بزر الماوس الأيمن على مفتاح حرف لمحاكاة الضغط على Shift + ذلك المفتاح.</li>
        <li><strong>قابلة للتحريك:</strong> انقر واسحب منطقة خلفية لوحة المفاتيح **بزر الماوس الأيسر** لتحريكها.</li>
        <li><strong>البقاء في المقدمة دائمًا:</strong> خيار لإبقاء النافذة مرئية فوق النوافذ الأخرى.</li>
        <li><strong>التكامل مع شريط النظام:</strong> تصغير إلى شريط النظام، تحديد التخطيط، إظهار/إنهاء التطبيق من قائمة الشريط (تستخدم أيقونة لوحة مفاتيح).</li>
        <li><strong>مظهر قابل للتخصيص:</strong>
            <ul>
                <li>ضبط عائلة الخط وحجمه.</li>
                <li>تغيير لون نص الأزرار.</li>
                <li>خيار استخدام **ألوان سمة النظام** لخلفيات النافذة والأزرار. عند التمكين، يتم اختيار لون النص (أسود/أبيض) تلقائيًا للتباين، ويتم تجاهل إعدادات الخلفية/النمط المخصصة.</li>
                <li>في حالة عدم استخدام ألوان النظام:
                    <ul>
                        <li>تعيين لون خلفية مخصص للنافذة.</li>
                        <li>تعيين لون خلفية مخصص للأزرار (يؤثر بشكل أساسي على النمط "Flat").</li>
                        <li>اختيار نمط الأزرار (Default, Flat, Gradient).</li>
                    </ul>
                </li>
                <li>ضبط **شفافية** خلفية النافذة (تعمل مع النوافذ ذات الإطار وبدونه، يتطلب دعم compositor).</li>
            </ul>
        </li>
        <li><strong>سلوك قابل للتهيئة:</strong>
            <ul>
                <li>**نافذة بدون إطار:** خيار لإزالة شريط عنوان النافذة وحدودها (الافتراضي: مفعل).</li>
                <li>تذكر موضع النافذة وحجمها.</li>
                <li>اختياريًا، تصغير/إخفاء النافذة بالنقر الأوسط على خلفيتها.</li>
                <li><strong>الظهور التلقائي عند تحرير نص:</strong> إظهار لوحة المفاتيح تلقائيًا عند انتقال التركيز إلى حقل نصي قابل للتحرير (يتطلب خدمات إمكانية الوصول AT-SPI).</li>
                <li>**تكرار تلقائي للمفاتيح:** تمكين/تعطيل تكرار المفتاح عند الضغط المطول (يشمل مفاتيح الأسهم) وضبط التأخير الأولي والفاصل الزمني للتكرار.</li>
                <li>**الظهور في جميع مساحات العمل (Sticky):** _[خيار موجود ولكن غير فعال حاليًا]_ الهدف منه جعل لوحة المفاتيح مرئية في جميع أسطح المكتب الافتراضية.</li>
            </ul>
        </li>
    </ul>

    <h2>كيفية الاستخدام:</h2>
    <ol>
        <li>
            <strong>بدء تشغيل لوحة المفاتيح:</strong> قم بتشغيل "PyXKeyboard" من قائمة التطبيقات أو اكتب <code>pyxkeyboard</code> في الطرفية.
        </li>
        <li>
            <strong>الكتابة:</strong> افتح التطبيق الهدف (مثل محرر النصوص)، ثم انقر على المفاتيح في لوحة المفاتيح الافتراضية. يجب أن تظهر الأحرف إذا كانت ميزة XTEST تعمل.
        </li>
        <li>
            <strong>استخدام شيفت، كنترول، آلت:</strong>
            <ul>
                <li>انقر على <code>Shift</code> أو <code>Ctrl</code> أو <code>Alt</code> مرة واحدة. سيتم تمييزه. انقر على المفتاح التالي (حرف أو مفتاح وظيفي). سيتم تحرير مفتاح التعديل تلقائيًا بعد ذلك.</li>
                <li>النقر بزر الماوس الأيمن على مفتاح حرف (مثل النقر الأيمن على <code>a</code>) يحاكي Shift+A مباشرةً.</li>
            </ul>
        </li>
         <li>
            <strong>استخدام قفل الإدخال بالأحرف الكبيرة (Caps Lock):</strong> انقر على مفتاح <code>⇪ Caps</code>. يؤدي هذا إلى تبديل حالة Caps Lock في النظام (إذا كانت XTEST تعمل) والمظهر المرئي لمفاتيح الأحرف في لوحة المفاتيح الافتراضية.
        </li>
        <li>
            <strong>استخدام مفاتيح الأسهم:</strong> انقر على مفاتيح الأسهم (<code>↑</code>, <code>↓</code>, <code>←</code>, <code>→</code>). الضغط المطول عليها سيؤدي إلى التكرار التلقائي إذا كان مفعلًا.
        </li>
        <li>
            <strong>تبديل اللغات (التخطيطات):</strong>
            <ul>
                <li><strong>باستخدام زر <code>Lang</code>:</strong> انقر على الزر المسمى <code>AR</code> أو <code>EN</code>. يقوم بتبديل تخطيط النظام (إذا أمكن) وتحديث عرض لوحة المفاتيح الافتراضية.</li>
                <li><strong>باستخدام شريط النظام:</strong> انقر بزر الماوس الأيمن على **أيقونة لوحة المفاتيح** في شريط النظام، انتقل إلى "Select Layout" (تحديد التخطيط)، وانقر على اسم التخطيط المطلوب (مثل <code>us</code> أو <code>ara</code>).</li>
            </ul>
        </li>
        <li>
            <strong>التصغير / الإخفاء:</strong>
            <ul>
                <li>انقر على زر الإغلاق القياسي (<code>X</code>) إذا كانت النافذة بإطار. سيتم إخفاؤها في شريط النظام إن كان متاحًا، وإلا سيتم إنهاء التطبيق.</li>
                 <li>انقر على الزر المخصص <code>_</code> (إذا كانت النافذة بدون إطار). سيتم إخفاؤها في شريط النظام إن كان متاحًا، وإلا سيتم إخفاء النافذة فقط.</li>
                 <li>إذا تم تمكينه في الإعدادات، انقر <strong>بالنقر الأوسط</strong> (نقر عجلة الماوس) في أي مكان على منطقة خلفية لوحة المفاتيح (وليس على زر) لإخفائها في شريط النظام/تصغيرها/إخفائها.</li>
            </ul>
        </li>
        <li>
            <strong>الإظهار من شريط النظام:</strong>
            <ul>
                 <li>انقر <strong>بالنقر الأيسر</strong> على **أيقونة لوحة المفاتيح** في شريط النظام.</li>
                 <li>بدلاً من ذلك، انقر <strong>بالنقر الأيمن</strong> على الأيقونة واختر "<strong>Show Keyboard</strong>" (إظهار لوحة المفاتيح).</li>
            </ul>
        </li>
        <li>
             <strong>تحريك لوحة المفاتيح:</strong> انقر في أي مكان على منطقة الخلفية الرئيسية للوحة المفاتيح الافتراضية (وليس على زر) **بزر الماوس الأيسر** واسحبها.
        </li>
         <li>
            <strong>الإعدادات:</strong> انقر على زر <strong><code>Set</code></strong> لفتح نافذة الإعدادات والمساعدة. قم بتهيئة الخيارات مثل:
            <ul>
                 <li>**عام:** تذكر الهندسة، البقاء في المقدمة، الالتصاق (غير فعال)، إخفاء بالنقر الأوسط، إظهار تلقائي، نافذة بدون إطار.</li>
                 <li>**المظهر:** الخط، لون نص الأزرار، استخدام ألوان السمة (يتجاوز الألوان/الأنماط أدناه)، لون خلفية النافذة/الأزرار المخصص، شفافية الخلفية، نمط الأزرار المخصص (يُتجاهل عند استخدام ألوان السمة).</li>
                 <li>**الكتابة:** تمكين/تعطيل التكرار التلقائي، ضبط التأخير والفاصل الزمني.</li>
                 <li>**المساعدة:** عرض أدلة المساعدة (إنجليزي وعربي).</li>
            </ul>
        </li>
        <li>
            <strong>إنهاء التطبيق:</strong>
            <ul>
                <li>انقر على الزر المخصص <code>X</code> (إذا كانت النافذة بدون إطار).</li>
                <li>انقر <strong>بالنقر الأيمن</strong> على **أيقونة لوحة المفاتيح** في شريط النظام واختر "<strong>Quit</strong>" (إنهاء).</li>
                <li>أغلق النافذة بزر الإغلاق القياسي إذا كانت بإطار ولم يكن شريط النظام متاحًا.</li>
            </ul>
        </li>
    </ol>

    <div class="note">
        <h2>ملاحظات استكشاف الأخطاء وإصلاحها:</h2>
        <ul>
            <li><strong>الكتابة لا تعمل أو تُظهر حروفًا خاطئة:</strong>
                <ul>
                    <li>يعني هذا عادةً أن محاكاة XTEST معطلة أو لا تعمل بشكل صحيح (مثل جلسة Wayland، أو فقدان مكتبة <code>python-xlib</code>). تحقق من نافذة "About" (حول) لمعرفة حالة XTEST.</li>
                    <li>**هام:** إذا تمت كتابة أحرف خاطئة (على سبيل المثال، الضغط على <code>ذ</code> يكتب <code>ع</code>)، فهذا يعني غالبًا أن التخطيط النشط في نظام التشغيل (عبر <code>setxkbmap</code>) لا يتطابق تمامًا مع ما تتوقعه لوحة المفاتيح الافتراضية لـ *رمز* المفتاح هذا. تأكد من أن إعدادات تخطيط النظام صحيحة وتطابق أحد التخطيطات التي تدعمها لوحة المفاتيح الافتراضية بصريًا (مثل <code>us</code> أو <code>ara</code> القياسية).</li>
                 </ul>
            </li>
            <li><strong>تبديل اللغة لا يعمل:</strong>
                <ul>
                    <li>قد يعني هذا أن ملف <code>XKB_Switcher.py</code> مفقود، أو أن أمر <code>setxkbmap</code> فشل، أو وجود مشكلات في الأذونات. تظهر نافذة "About" (حول) حالة XKB.</li>
                    <li>قد لا تزال ترى التخطيط يتغير بصريًا على لوحة المفاتيح الافتراضية، لكن إعداد النظام لن يتغير.</li>
                 </ul>
            </li>
            <li><strong>لغة واحدة فقط متاحة:</strong> إذا لم تتمكن من التبديل، فمن المحتمل أن لديك تخطيطًا واحدًا فقط مهيأ في إعدادات نظام التشغيل (مثل 'us' فقط). أضف المزيد عبر إعدادات النظام.</li>
            <li><strong>أيقونة شريط النظام مفقودة:</strong> قد تفتقر بعض أسطح مكتب لينكس إلى دعم شريط النظام أو تتطلب تهيئة.</li>
            <li><strong>الإخفاء بالنقر الأوسط لا يعمل:</strong> تأكد من تحديد خيار "Minimize window on middle mouse click" في نافذة الإعدادات (علامة التبويب "General").</li>
            <li><strong>الظهور التلقائي لا يعمل:</strong>
                <ul>
                    <li>تأكد من تحديد خيار "Auto-show keyboard..." في الإعدادات (تبويب "General").</li>
                    <li>تحقق من أن خدمات إمكانية الوصول AT-SPI قيد التشغيل في نظامك (تحقق من إعدادات إمكانية الوصول في بيئة سطح المكتب لديك). قد تحتاج إلى تثبيت حزم مثل <code>at-spi2-core</code>، <code>python3-gi</code>، <code>gir1.2-atspi-2.0</code>.</li>
                    <li>تحقق من نافذة "About" (حول) لمعرفة حالة AT-SPI (غير متاح N/A، نشط Active، غير نشط Inactive). تشير حالة "N/A" أو وجود أخطاء أثناء بدء التشغيل عادةً إلى فقدان المتطلبات.</li>
                    <li>قد تكون هذه الميزة أقل موثوقية في جلسات Wayland مقارنة بـ X11/Xorg.</li>
                </ul>
            </li>
            <li><strong>النافذة لا تبقى في المقدمة:</strong> تأكد من تحديد خيار "Always on Top" في الإعدادات. تعتمد الميزة على دعم مدير النوافذ.</li>
            <li><strong>خيار "Sticky" لا يعمل:</strong> هذه الميزة (الظهور في جميع مساحات العمل) غير مفعلة حاليًا في التطبيق.</li>
            <li>**مشاكل في المظهر (شفافية/ألوان):** قد تختلف شفافية الخلفية والألوان المخصصة أو تظهر بشكل غريب اعتمادًا على مدير النوافذ لديك وما إذا كان مُركِّب (compositor) يعمل (خاصة مع النوافذ ذات الإطار). استخدام ألوان سمة النظام هو الخيار الأكثر موثوقية بشكل عام.</li>
            <li>**أيقونة التطبيق عامة:** بعد تثبيت حزمة DEB، نفذ الأمر <code>sudo gtk-update-icon-cache /usr/share/icons/hicolor/</code> ثم قم بتسجيل الخروج والدخول مرة أخرى.</li>
        </ul>
    </div>

    <!-- NEW: About Section -->
    <div class="about-section">
        <h2>حول Python XKeyboard</h2>
        <p>الإصدار: 1.0.2</p> <!-- Added version -->
        <p>تم التطوير بواسطة: خالد عبد الحميد<br>
        للتواصل: <a href="mailto:khaled1512@gmail.com">khaled1512@gmail.com</a></p>

        <p><strong>الترخيص:</strong><br>
        يتم توزيع هذا البرنامج بموجب شروط رخصة جنو العمومية الإصدار 3 (GPLv3).</p>

        <p><strong>إخلاء مسؤولية:</strong><br>
        يتم توفير هذا البرنامج "كما هو" دون أي ضمان من أي نوع، صريحًا كان أم ضمنيًا. استخدمه على مسؤوليتك الخاصة.</p>

        <p>إذا وجدت هذا البرنامج مفيدًا، يرجى التفكير في دعم تطويره عبر باي بال:<br>
        <a href="https://paypal.me/kh1512">https://paypal.me/kh1512</a><br>
        (رابط للنسخ: <code dir="ltr">paypal.me/kh1512</code>)</p>

        <p>شكرًا لك!</p>
    </div>
    <!-- End NEW Section -->

    <p style="text-align:center; margin-top: 30px; font-size: 0.9em; color: var(--subtle-text);">
        استمتع باستخدام Python XKeyboard!
    </p>

</body>
</html>
